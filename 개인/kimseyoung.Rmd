---
title: "남편의 초혼연령대 분석"
output: html_document
---
***
#초록
***
이 연구의 목적은 '초혼 건수를 연도별, 지역별, 연령별의  다양한 시각으로 접근'하는 것이다. 연구에 사용된 자료는 국가통계포털에 공개된 '시도/초혼연령별 혼인'자료이다. 실증분석자료는 8개의 광역시(서울특별시, 부산광역시, 인천광역시, 대구광역시, 대전광역시, 광주광역시, 울산광역시, 세종특별자치시)와 9개의 도(경기도, 경상남도, 경상북도, 충청남도, 충청북도, 전라남도, 전라북도, 강원도, 제주특별자치도)를 표본으로 2007년~2016년의 10개년 통계자료를 통합하여 구축되었다. 또한 지역별로 연도별, 연령별의 다양한 데이터를 사용했다.
서론의 분석에서는 분석에 필요한 패키지를 불러오며 본격적인 분석에 앞서 데이터를 검토 및 전처리를 할 것이다.  
이러한 데이터를 바탕으로, 본론의 분석에서는 '남편의 혼인건이 제일 많은 연령대'를 2016년 전국으로 한정지어 분석하였고, '지역별  남편 혼인건이 제일 많은 연령대'를 2016년으로 한정지어 분석했다. 이를 통해 남편은 30-34세에 혼인건이 제일 많은 것과 인구가 많은 지역이 혼인건수도 많다는 것을 확인할 것이다. 마지막으로 앞에서 분석한 내용들이 근 10년간 어떤 변화가 있는지를 분석하여 혼인연령의 상승과 혼인건수가 하락세임을 확인할 것이다.  

***
#서론
***
##분석 주제
1인가구 증가로 인해 혼인율이 감소하는 추세인 현재, 근 10년간 연령별 혼인건수에 대해 어떤 변화가 있었는지에 대한 궁금증으로 데이터를 선정했다. 전국의 평균 혼인건수로 어떤 연령대에 혼인을 제일 많이 하는지를 알아보며 여기에 지역, 연도라는 변수를 추가하여 이들이 혼인연령에 어떠한 영향을 미치는가를 알아볼 것이다.

##데이터선정
***
###1)데이터 선정이유
분석초보인 필자는 '혼인'이라는 키워드가 비교적 가볍게 다가왔기 때문에 이 데이터를 선정했다.
이와 더불어 비용등의 문제로 결혼을 기피하게 되는 현재에 남편의 초혼의 연령대가 지역별, 년도별로 어떻게 변화하는지에 대한 궁금증을 해소하기 위해 이를 분석하기로 결정했다. 

###2)데이터 소개
구축된 데이터는 국가통계포털에서  공개된 '시도/초혼연령별 혼인'자료이다. 세부 내용으로는 시도별, 연령별, 시점, 남편, 아내이다.  
1. 필요한 데이터와 패키지를 불러온다.
```{r}
library(dplyr)
library(ggplot2)
marriage <- read.csv("marriage_csv.csv")
```
2. 데이터 속성을 파악하고 결측치가 없는지 확인한다.
```{r}
str(marriage)
table(is.na(marriage))
```
3. 변수명을 영문명으로 변경한다.(뒤에서 그래프로 표현하는 것을 대비해서)
```{r}
marriage <- rename(marriage,  sido = 시도별, age = 연령별, year = 시점, m = 남편,  w = 아내)
str(marriage)
```
4. 필요없는 데이터를 필터링하여 복사본을 만든다.
```{r}
kmarriage <- marriage %>%
  filter(sido != "읍부" & sido != "면부" & sido != "동부" & sido != "국외" & age != "계" & age != "미상") %>%
  select(-w)
```
***
#본론
***
####[1]전국적으로 남녀 혼인건이 제일 많은 연령대를 구하기 
통합된 전국의 데이터에서 연도를 2016년으로 한정지어 남녀 혼인건수가 제일 많은 연령대를 구하였다. 전국적으로는 30-34세에 혼인건수가 제일 많은 것으로 나타났다. 
```{r}
kmarriage %>%
  filter(sido == "전국" & year == "2016 년") %>% 
  arrange(desc(m)) %>% 
  head(1)
```
####[2]지역별로 남녀 혼인건이 제일 많은 연령대를 구하기
연도를 2016년으로 한정지어 지역별로 어떤 연령대의 혼인건수가 제일 많은지 알아보았다.
그 결과 경기도, 서울특별시, 부산광역시, 경상남도, 인천광역시, 대구광역시, 경상북도, 충청남도, 대전광역시, 충청북도, 전라북도, 전라남도, 울산광역시, 강원도, 제주특별자치도, 세종특별자치시순으로 혼인건수가 많은 것으로 나타났고 이 안에서도 모든 지역에서 30-34세에 혼인건수가 제일 많은 것으로 나타났다.
```{r}
kmarriage %>% 
  filter(sido != "전국" & year == "2016 년" ) %>% 
  group_by(sido) %>% 
  summarise(max_m = max(m)) %>%
  arrange(desc(max_m))

km1 <-  kmarriage %>% 
  select(sido, age, m) %>% 
  filter(m == 26511 | m == 25501 | m == 6699 | m == 6280 | m == 5781 | m == 4856 | m == 4502 | m == 3977 | m == 3256 | m == 2850 | m == 2701 | m == 2686 | m == 2661 | m == 2573 | m == 2199 | m == 1112 | m == 673 & age!= "40 - 44세") %>% 
  arrange(desc(m))
km1

```
위에서 분석한 코드를 가독성을 위해 빈도표 및 그래프로 표현한다.
초혼연령대를 나타내는 빈도표에서는 위에서 분석했듯이 30-34세에 모든 지역이 초혼건수가 제일 많았던 것을 한 눈에 볼 수 있다.
막대그래프로도 위와 마찬가지다.
초혼의 건수를 나타내는 막대그래프는 경기도와 서울이 초혼건수가 압도적으로 많다는 것을 보여준다.
```{r}
table(km1$age)
ggplot(data = km1, aes(x= sido, y = age)) + geom_col() + coord_flip()
ggplot(data = km1, aes(x= reorder(sido, -m), y = m)) + geom_col() + coord_flip()
```

좀 더 가독성을 높이기 위해 대한민국 시도별 혼인건수 단계 구분도를 만든다.
install.packages("ggiraphExtra")
install.packages("stringi")
install.packages("devtools")
devtools::install_github("cardiomoon/kormaps2014")
```{r}
library(ggiraphExtra)
library(kormaps2014)

km1[ ,1] <- c("Gyeonggi-do", "Seoul", "Busan", "Gyeongsangnam-do", "Incheon", "Daegu", "Gyeongsangbuk-do", "Chungcheongnam-do", "Daejeon", "Gwangju", "Chungcheongbuk-do", "Jeollabuk-do", "Jeollanam-do", "Ulsan", "Gangwon-do", "Jeju-do", "Sejong")

x <- data.frame(code = c(11, 21:26, 29, 31:39),
                sido = c("Seoul", "Busan", "Daegu", "Incheon", "Gwangju", "Daejeon", "Ulsan", "Sejong", "Gyeonggi-do", "Gangwon-do", "Chungcheongbuk-do", "Chungcheongnam-do", "Jeollabuk-do", "Jeollanam-do", "Gyeongsangbuk-do", "Gyeongsangnam-do", "Jeju-do"))

art <- left_join(km1, x, by = "sido")

str(changeCode(kormap1))
str(changeCode(art))
ggChoropleth(data = art,
             aes(fill = m,
                 map_id = code,
                 tooltip = sido),
             map = kormap1,
             interactive = T)
```

####[3]근 10년간 어떠한 양상으로 나타나는가

#####1.근 10년간의 전국적인 남녀 혼인건이 제일 많은 연령대를 구하기  
통합된 전국의 데이터를 이번에는 연도를 한정짓지 않고 근 10년을 기준으로 남녀 혼인건수가 제일 많은 연령대를 구하였다. 근 10년간 전국적으로 혼인건수가 30-34세에 제일 많이 나타나는 현상이 8개년에서 나타났다. 2007년과 2008년에는 25-29세에 혼인건수가 제일 많은 것을 알 수 있다.
```{r}
kmarriage %>% 
  filter(sido == "전국") %>% 
  group_by(year) %>% 
  summarise(max_m = max(m)) %>%
  arrange(desc(max_m))

km2 <- kmarriage %>% 
  select(year, age, m) %>% 
  filter(m == 128037 | m == 125180 | m == 119565 | m == 118650 | m == 117335 | m == 115080 | m == 111457 | m == 106096 | m == 105758 | m == 101049) %>%
  arrange(desc(m))
km2
```
위에서 분석한 코드를 가독성을 위해 빈도표 및 그래프로 표현한다.
초혼연령대를 나타내는 빈도표에서는 위에서 분석했듯이 30-34세에 빈도가 8로 가장 많은 것을 볼 수 있고 25-29세에 빈도가 2임을 볼 수 있다.
막대그래프로도 위와 마찬가지다. 막대그래프로 봤을 때 2008년 이후로 혼인연령이 30-34세로 상승했음을 확인할 수 있다.
초혼의 건수를 나타내는 막대그래프는 근 10년간 전국의 혼인건수가 하락세임을 나타낸다.
```{r}
table(km2$age)
ggplot(data = km2, aes(x= year, y = age)) + geom_col() + coord_flip()
ggplot(data = km2, aes(x= reorder(year, -m), y = m)) + geom_col() + coord_flip()
```

#####2.근 10년간 지역별 남녀 혼인건이 제일 많은 지역 구하기  
연도를 한정짓지 않고 지역별로 근 10년을 기준으로 남녀 혼인건수가 제일 많은 지역을 구하였다. 근 10년간 서울특별시에서 30-34세에 혼인건수가 제일 많았고 2016년에만 경기도에서 30-34세에 혼인건수가 제일 많은 것을 확인 할 수 있다.
```{r}
kmarriage %>% 
  filter(sido != "전국" ) %>% 
  group_by(year) %>% 
  summarise(max_m = max(m)) %>%
  arrange(desc(max_m))

km3 <- kmarriage %>% 
  select(year, sido, age, m) %>% 
  filter(m == 31879 | m == 31540 | m == 30117 | m == 29525 | m == 29231 | m == 29047 | m == 28215 | m == 27134 | m == 26622 | m == 26511) %>% 
  arrange(desc(m))
km3
```
위에서 분석한 코드를 가독성을 위해 빈도표 및 그래프로 표현한다. 지역을 나타내는 빈도표에서는 위에서 분석했듯이 서울특별시에 빈도가 9로 가장 많은 것을 볼 수 있고 경기도에 빈도가 1임을 볼 수 있다. 막대그래프로도 위와 마찬가지다. 막대그래프로 봤을 때 2016년에 갑자기 혼인건수가 많은 지역이 서울특별시에서 경기도로 변화한 것을 알 수 있다. 지역별 초혼의 건수를 나타내는 막대그래프는 근 10년간 전국의 혼인건수가 하락세임을 나타낸다.
```{r}
table(km3$sido)
ggplot(data = km3, aes(x= year, y = sido)) + geom_col() + coord_flip()
ggplot(data = km3, aes(x= reorder(year, -m), y = m)) + geom_col() + coord_flip()
```

#####3.지역비교  
aggregate()함수를 사용하여 근 10년의 지역별 초혼건수가 제일 많은 지역을 차례대로 나열하였다. 
세종특별자치시는 2012년에 출범하였기 때문에 총 165개의 데이터가 산출된다.
위에서 분석한 코드를 가독성을 위해 그래프로 표현한다. 상자그림을 통해 년도별, 지역별 분포 차이를 표현했다. 연도별로 표현된 상자그림에서는 서울특별시와 경기도가 인구가 다른 지역보다 많기 때문에 이상치로 나타난다 또한 중앙값은 연도별로 크게 차이가 없는 것을 볼 수 있다.
지역별로 표현된 상자그림에서는 위의 상자그림과 마찬가지로 경기도와 서울특별시가 혼인건수가 약 3배로 극단적으로 많기 때문에 상자그림자체가 다른 지역의 상자그림보다 위에 위치한 것을 확인 할 수 있다.
```{r}
kmarriage_2 <- kmarriage %>% 
  filter(sido != "전국")

km4 <- aggregate(m~sido+year, kmarriage_2, max)
km4

ggplot(data = km4, aes(x= year, y = m)) + geom_boxplot()
ggplot(data = km4, aes(x= sido, y = m)) + geom_boxplot()
```

***
#결론
***
본 연구를 진행하면서 한계로 지적될 수 있는 것은 첫 번째로 필자의 분석능력의 부족함이다. 본론[2], [3]에서 filter()와 summarise()를 거쳐서 나온 값을 최종적으로 sido, age, m을 출력해야 하는데 이 과정에서 나온 m의 값을 하나하나 직접 적어서 표현 하는 방법을 사용하였다.
두 번째로는 년도 설정을 너무 짧게 잡았다는 점이다. 연도를 10년보다 폭넓게 잡는다면 좀 더 뚜렷한 변화를 나타낼 수 있을 것이다.